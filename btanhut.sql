CREATE DATABASE QLBH
USE QLBH

CREATE TABLE KHACHHANG
(
	MAKH CHAR(4),
	HOTEN VARCHAR(40),
	DCHI VARCHAR(40),
	SODT VARCHAR(10),
	NGSINH SMALLDATETIME,
	DOANHSO MONEY,
	NGDK SMALLDATETIME
	PRIMARY KEY(MAKH)
)

CREATE TABLE NHANVIEN
(
	MANV CHAR(4),
	HOTEN VARCHAR(40),
	NGVL SMALLDATETIME,
	SODT VARCHAR(10)
	PRIMARY KEY(MANV)
)

CREATE TABLE SANPHAM
(
	MASP CHAR(4),
	TENSP VARCHAR(40),
	DVT VARCHAR(10),
	NUOCSX VARCHAR(10),
	GIA MONEY
	PRIMARY KEY(MASP)
)

CREATE TABLE HOADON
(
	SOHD CHAR(4),
	NGHD SMALLDATETIME,
	MAKH CHAR(4),
	MANV CHAR(4),
	TRIGIA MONEY
	PRIMARY KEY(SOHD)
)

CREATE TABLE CTHD
(
	SOHD CHAR(4),
	MASP CHAR(4),
	SL INT
	PRIMARY KEY(SOHD,MASP)
)

/*
	CAU 1
*/

SELECT MASP,TENSP FROM SANPHAM WHERE NUOCSX = 'Trung Quoc'

/*
	CAU 2
*/

SELECT MASP,TENSP FROM SANPHAM WHERE DVT IN ('Cay','Quyen')

/*
	CAU 3
*/

SELECT MASP,TENSP FROM SANPHAM WHERE MASP LIKE 'B%01'

/*
	CAU 4
*/

SELECT MASP,TENSP FROM SANPHAM WHERE NUOCSX = 'Trung Quoc' AND GIA BETWEEN 30000 AND 40000

/*
	CAU 5
*/

SELECT MASP,TENSP FROM SANPHAM WHERE NUOCSX IN ('Trung Quoc','Thai Lan') AND GIA BETWEEN 30000 AND 40000

/*
	CAU 6
*/

SET DATEFORMAT DMY
SELECT SOHD,TRIGIA  FROM HOADON WHERE NGHD BETWEEN '1-1-2007' AND '2-1-2007'

/*
	CAU 7
*/

SELECT SOHD,TRIGIA  
FROM HOADON 
WHERE NGHD BETWEEN '1-1-2007' AND '31-1-2007'
ORDER BY DAY(NGHD) ASC , TRIGIA DESC

/*
	CAU 8
*/

SELECT KHACHHANG.MAKH,HOTEN 
FROM (HOADON JOIN KHACHHANG ON HOADON.MAKH = KHACHHANG.MAKH)
WHERE NGHD = '1-1-2007'

/*
	CAU 9
*/

SELECT SOHD,TRIGIA
FROM (HOADON JOIN NHANVIEN ON HOADON.MANV = NHANVIEN.MANV)
WHERE NGHD = '28-10-2006' AND HOTEN = 'Nguyen Van B'

/*
	CAI 10
*/

SELECT KHACHHANG.MAKH,HOTEN 
FROM (HOADON JOIN KHACHHANG ON HOADON.MAKH = KHACHHANG.MAKH) JOIN CTHD ON CTHD.SOHD = HOADON.SOHD
WHERE NGHD BETWEEN '1-10-2006' AND '31-1-2006' AND HOTEN = 'Nguyen Van A'

/*
	CAU 11
*/

SELECT SOHD
FROM CTHD 
WHERE MASP IN ('BB01','BB02')

/*
	CAU 12
*/

SELECT SOHD
FROM CTHD 
WHERE MASP IN ('BB01','BB02') AND SL BETWEEN 10 AND 20

/* 
	CAU 13
*/

SELECT SOHD
FROM CTHD A
WHERE A.MASP = 'BB01' AND SL BETWEEN 10 AND 20 
AND EXISTS
(
	SELECT *
	FROM CTHD B
	WHERE B.MASP = 'BB02' AND SL BETWEEN 10 AND 20 AND A.SOHD = B.SOHD
)

/*
	CAU 14
*/

SELECT DISTINCT S.MASP, TENSP
FROM SANPHAM S JOIN CTHD C1
ON S.MASP = C1.MASP
WHERE NUOCSX = 'TRUNG QUOC'
AND C1.SOHD IN
(
	SELECT DISTINCT C2.SOHD
	FROM CTHD C2 JOIN HOADON H
	ON C2.SOHD = H.SOHD
	WHERE NGHD ='1/1/2007'
)

/*
	CAU 15
*/

SELECT MASP, TENSP
FROM SANPHAM
WHERE SANPHAM.MASP NOT IN
(
	SELECT CTHD.MASP 
	FROM CTHD 
)
/*
	CAU 16
*/

SELECT SANPHAM.MASP, TENSP
FROM SANPHAM 
WHERE SANPHAM.MASP NOT IN
(
	SELECT MASP 
	FROM CTHD JOIN HOADON  ON CTHD.SOHD = HOADON.SOHD
	WHERE YEAR(NGHD) = 2006
)

/*
	CAU 17
*/

SELECT SANPHAM.MASP, TENSP
FROM SANPHAM 
WHERE SANPHAM.NUOCSX = 'Trung Quoc' 
AND SANPHAM.MASP NOT IN
(
	SELECT MASP 
	FROM CTHD JOIN HOADON  ON CTHD.SOHD = HOADON.SOHD
	WHERE YEAR(NGHD) = 2006
)

/*
	CAU 18
*/

SELECT H.SOHD 
FROM HOADON H
WHERE YEAR(NGHD) = 2006 
AND NOT EXISTS
(
	SELECT *
	FROM SANPHAM S
	WHERE NUOCSX = 'Singapore'
	AND NOT EXISTS
	(
		SELECT * 
		FROM CTHD C
		WHERE C.SOHD = H.SOHD AND C.MASP = S.MASP
	)
)

/*
	CAU 19
*/

SELECT COUNT(*)
FROM HOADON H
WHERE MAKH NOT IN
(
	SELECT MAKH
	FROM KHACHHANG K 
	WHERE K.MAKH = H.MAKH
)

/*
	CAU 20
*/

SELECT COUNT(DISTINCT MASP)
FROM CTHD C INNER JOIN HOADON H ON C.SOHD = H.SOHD
WHERE YEAR(NGHD) = 2006

/*
	CAU 21
*/

SELECT MAX(TRIGIA), MIN(TRIGIA)
FROM HOADON

/*
	CAU 22
*/

SELECT AVG(TRIGIA)
FROM HOADON

/*
	CAU 23
*/

SELECT SUM(TRIGIA) 
FROM HOADON
WHERE YEAR(NGHD) = 2006

/*
	CAU 24
*/

SELECT SOHD
FROM HOADON
WHERE TRIGIA = 
(
	SELECT MAX(TRIGIA) 
	FROM HOADON
)

/*
	CAU 25
*/

SELECT HOTEN
FROM KHACHHANG K INNER JOIN HOADON H ON K.MAKH = H.MAKH 
AND SOHD = 
(
	SELECT SOHD
	FROM HOADON
	WHERE TRIGIA = 
	(
		SELECT MAX(TRIGIA)
		FROM HOADON
	)
)

/*
	CAU 26
*/

SELECT TOP 3 MAKH, HOTEN
FROM KHACHHANG
ORDER BY DOANHSO DESC

/*
	CAU 27
*/

SELECT MASP, TENSP
FROM SANPHAM
WHERE GIA IN 
(
	SELECT DISTINCT TOP 3 GIA
	FROM SANPHAM
	ORDER BY GIA DESC
)

/*
	CAU 28
*/

SELECT MASP, TENSP
FROM SANPHAM
WHERE NUOCSX = 'Thai Lan' 
AND GIA IN 
(
	SELECT DISTINCT TOP 3 GIA
	FROM SANPHAM
	ORDER BY GIA DESC
)

/*
	CAU 29
*/

SELECT MASP, TENSP
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc' 
AND GIA IN 
(
	SELECT DISTINCT TOP 3 GIA
	FROM SANPHAM
	WHERE NUOCSX = 'Trung Quoc'
	ORDER BY GIA DESC
)

/*
	CAU 30
*/

SELECT TOP 3 MAKH, HOTEN
FROM KHACHHANG
ORDER BY DOANHSO DESC

/*
	CAU 31
*/

SELECT COUNT(DISTINCT MASP)
FROM SANPHAM
WHERE NUOCSX = 'TRUNG QUOC'

/*
	CAU 32
*/

SELECT NUOCSX, COUNT(DISTINCT MASP)
FROM SANPHAM
GROUP BY NUOCSX

/*
	CAU 33
*/

SELECT NUOCSX, MAX(GIA), MIN(GIA), AVG(GIA)
FROM SANPHAM
GROUP BY NUOCSX

/* 
	CAU 34
*/

SELECT NGHD, SUM(TRIGIA)
FROM HOADON
GROUP BY NGHD

/*
	CAU 35
*/

SELECT MASP, COUNT(DISTINCT MASP)
FROM SANPHAM
WHERE MASP IN
(
	SELECT MASP
	FROM CTHD C INNER JOIN HOADON H ON C.SOHD = H.SOHD
	WHERE NGHD BETWEEN '1-10-2006' AND '31-1-2006'
)
GROUP BY MASP

/*
	CAU 36
*/

SELECT MONTH(NGHD), SUM(TRIGIA)
FROM HOADON
WHERE YEAR(NGHD) = 2006
GROUP BY MONTH(NGHD)

/*
	CAU 37
*/

SELECT *
FROM HOADON H
WHERE 4 <= 
(
	SELECT COUNT(*)
	FROM CTHD C
	WHERE H.SOHD = C.SOHD
)

/* 
	CAU 38
*/

SELECT *
FROM HOADON H
WHERE 4 <= 
(
	SELECT COUNT(*)
	FROM CTHD C JOIN SANPHAM S ON C.MASP = S.MASP
	WHERE H.SOHD = C.SOHD AND NUOCSX = 'Viet Nam'
)

/*
	CAU 39
*/

SELECT MAKH, HOTEN
FROM KHACHHANG
WHERE MAKH = 
(
	SELECT TOP 1 MAKH
	FROM HOADON
	GROUP BY MAKH
	ORDER BY COUNT(DISTINCT SOHD) DESC
)

/*
	CAU 40
*/

SELECT TOP 1 MONTH(NGHD)
FROM HOADON
WHERE YEAR(NGHD) = 2006
GROUP BY MONTH(NGHD)
ORDER BY SUM(TRIGIA) DESC

/*
	CAU 41
*/

SELECT MASP, TENSP
FROM SANPHAM
WHERE MASP = 
(
	SELECT TOP 1 MASP
	FROM CTHD
	GROUP BY MASP
	ORDER BY SUM(SL) ASC
)

/*
	CAU 42
*/

SELECT B.NUOCSX,MASP,TENSP
FROM 
(
	SELECT NUOCSX,MAX(GIA) AS MAX
	FROM SANPHAM
	GROUP BY NUOCSX
) AS B JOIN SANPHAM S ON (B.MAX = S.GIA AND B.NUOCSX = S.NUOCSX)

/*
	CAU 43
*/

SELECT LUCDEPTRAI.NUOCSX
FROM
(
	SELECT NUOCSX,COUNT(MASP) AS SL
	FROM SANPHAM
	GROUP BY NUOCSX
) AS LUCDEPTRAI
WHERE LUCDEPTRAI.SL >= 3

/*
	CAU 44
*/

SELECT *
FROM KHACHHANG
WHERE MAKH = 
(
	SELECT TOP 1 A.MAKH
	FROM 
	(
		SELECT TOP 10 MAKH
		FROM KHACHHANG
		ORDER BY DOANHSO DESC
	) AS A
	LEFT JOIN 
	(
		SELECT MAKH, COUNT(SOHD) AS SL
		FROM HOADON
		GROUP BY MAKH
	) AS B ON A.MAKH = B.MAKH
	ORDER BY SL DESC
)
